---
import Layout from '@src/layouts/Layout.astro';
import Map from '@src/components/Map.svelte';
import { nanoid } from 'nanoid';

import { getCollection } from 'astro:content';

// TODO need to massage this before passing to Svelte
// e.g. do the image compression stuff on the server
const content = await getCollection('hkjapan');

const mapPages = content.map((item) => {
  const { 
    data: { 
      component,
      date,
      title,
      map,
      images,
    }
  } = item;

  return {
    slug: item.slug,
    component,
    body: item.body,
    date,
    title,
    map,
    images: (images ?? []).map((i) => ({
      ...i,
      id: nanoid(),
    }))
  }
});

---
<Layout title="Hong Kong and Japan 2023" loadMaps>
  <Map client:only mapPages={mapPages} />
</Layout>
