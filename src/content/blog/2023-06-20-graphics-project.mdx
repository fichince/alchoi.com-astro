---
title: My fourth-year ray tracer project
description: Even back then, I loved pool
date: 2023-06-20
tags:
  - coding
  - tech
  - fun
image: ../../images/blog/cow.png
---

import BlogImage from '../../components/BlogImage.astro';
import newprimitives from '../../../public/images/blog/cs488/newprimitives.png';
import cylinderprimitives from '../../../public/images/blog/cs488/cylinderprimitives.png';
import coneprimitives from '../../../public/images/blog/cs488/coneprimitives.png';
import reflectionred from '../../../public/images/blog/cs488/reflection-redball.png';
import reflectionmirror from '../../../public/images/blog/cs488/reflection-mirrorball.png';
import refraction1 from '../../../public/images/blog/cs488/refraction1.0.png';
import refraction13 from '../../../public/images/blog/cs488/refraction1.3.png';
import refraction15 from '../../../public/images/blog/cs488/refraction1.5.png';
import refraction18 from '../../../public/images/blog/cs488/refraction1.8.png';
import refraction2 from '../../../public/images/blog/cs488/refraction2.0.png';
import refraction25 from '../../../public/images/blog/cs488/refraction2.5.png';
import brick from '../../../public/images/blog/cs488/brick.jpg';
import texturebrick from '../../../public/images/blog/cs488/texture_brick.png';
import earth from '../../../public/images/blog/cs488/earth_tn.jpg';
import textureearth from '../../../public/images/blog/cs488/texture_earth.png';
import noisepure2 from '../../../public/images/blog/cs488/noise_pure0.2.png';
import noisepure5 from '../../../public/images/blog/cs488/noise_pure0.5.png';
import noisepure8 from '../../../public/images/blog/cs488/noise_pure0.8.png';
import noisepurecolour from '../../../public/images/blog/cs488/noise_pure_colour.png';
import noisewood1 from '../../../public/images/blog/cs488/noise_wood0.1.png';
import noisewood2 from '../../../public/images/blog/cs488/noise_wood0.2.png';
import noisewood5 from '../../../public/images/blog/cs488/noise_wood0.5.png';
import noisewood8 from '../../../public/images/blog/cs488/noise_wood0.8.png';
import noisewoodcolour from '../../../public/images/blog/cs488/noise_wood_colour.png';
import noisemarble03 from '../../../public/images/blog/cs488/noise_marble0.3.png';
import noisemarble1 from '../../../public/images/blog/cs488/noise_marble1.0.png';
import noisemarble13 from '../../../public/images/blog/cs488/noise_marble1.3.png';
import noisemarble18 from '../../../public/images/blog/cs488/noise_marble1.8.png';
import noiseprimitives from '../../../public/images/blog/cs488/noise_allprimitives.png';
import noisewoodcow from '../../../public/images/blog/cs488/noise_wood_cow.png';
import noisemarblecow from '../../../public/images/blog/cs488/noise_marble_cow.png';
import softshadowpointlight from '../../../public/images/blog/cs488/softshadowpointlight.png';
import softshadow2 from '../../../public/images/blog/cs488/softshadow2lights.png';
import softshadow5 from '../../../public/images/blog/cs488/softshadow5lights.png';
import softshadow10 from '../../../public/images/blog/cs488/softshadow10lights.png';
import softshadowsize1 from '../../../public/images/blog/cs488/softshadow1size.png';
import softshadowsize2 from '../../../public/images/blog/cs488/softshadow2size.png';
import softshadowsize3 from '../../../public/images/blog/cs488/softshadow3size.png';
import softshadowsize4 from '../../../public/images/blog/cs488/softshadow4size.png';
import glossiness1 from '../../../public/images/blog/cs488/glossiness1rays.png';
import glossiness2 from '../../../public/images/blog/cs488/glossiness2rays.png';
import glossiness10 from '../../../public/images/blog/cs488/glossiness10rays.png';
import glossiness50 from '../../../public/images/blog/cs488/glossiness50rays.png';
import glossiness10specular from '../../../public/images/blog/cs488/glossiness10specular.png';
import glossiness40specular from '../../../public/images/blog/cs488/glossiness40specular.png';
import glossiness70specular from '../../../public/images/blog/cs488/glossiness70specular.png';
import glossiness100specular from '../../../public/images/blog/cs488/glossiness100specular.png';
import scene from '../../../public/images/blog/cs488/scene.png';
import ball from '../../../public/images/blog/cs488/ball2.jpg';
import table from '../../../public/images/blog/cs488/table.png';

When I attended the University of Waterloo 20-ish years ago, all of the Computer Science undergrads, myself included, feared the so-called "Big 3," courses that were so hard as to drive students mad: **Real-time Programming**, **Compilers**, and **Computer Graphics**. 

When it came time to select my courses for fourth year, I knew I wanted to try one of them. I had a friend who dreamed of one day working on video games, so we decided to take the Graphics course together.

The final project involved creating a [ray tracer](https://en.wikipedia.org/wiki/Ray_tracing_(graphics)). After feverishly writing code for weeks, and a lot of time waiting for images to render, the final submission took the form of an image gallery. I remember being very proud of what I'd made. I still have all of the files, and there's no point keeping them hidden in the digital attic, so here I present my final project for CS488.

(Aside: the thumbnail image for this post that you see above was AI-generated by Stable Diffusion using the prompt: _a cow carved out of wood, 3d render_.)

----

## New primitives

New cylinder and cone primitives were created.

<BlogImage src={newprimitives} alt="new primitives" />

The radius and height of the primitives can be adjusted to create a variety of shapes.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={cylinderprimitives} alt="cylinder primitives" />
<BlogImage src={coneprimitives} alt="cone primitives" />
</div>

## Reflections

This image shows reflections. The good ol' "hallway of mirrors"...

<BlogImage src={reflectionred} alt="reflection red" />

This time, the ball itself is reflective, too.

<BlogImage src={reflectionmirror} alt="reflection mirror" />

## Refraction

The following sequence shows a refractive pane of glass with progressively larger indices of refraction.

<BlogImage src={refraction1} alt="refraction 1.0" 
  caption="Refraction index 1.0 - Light rays do not get bent at all." />

<div class="responsive-gallery tw-not-prose">
<BlogImage src={refraction13} alt="refraction 1.3" caption="Refraction index 1.3" />
<BlogImage src={refraction15} alt="refraction 1.5" caption="Refraction index 1.5" />
<BlogImage src={refraction18} alt="refraction 1.8" caption="Refraction index 1.8" />
<BlogImage src={refraction2} alt="refraction 2.0" caption="Refraction index 2.0" />
<BlogImage src={refraction25} alt="refraction 2.5" caption="Refraction index 2.5" />
</div>

## Texture mapping with images

Texture maps can be applied to all primitives except polygonal meshes.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={brick} alt="brick" />
<BlogImage src={texturebrick} alt="brick texture" />
</div>

<br />

<div class="responsive-gallery tw-not-prose">
<BlogImage src={earth} alt="earth" />
<BlogImage src={textureearth} alt="earth texture" />
</div>

## Texture mapping with Perlin noise

Perlin noise functions create pseudorandom textures. The noise functions can be used to achieve many types of textures:

### Pure noise

"Pure" noise gives a sort of dirty look to the texture. Different values for the persistence parameter achieves varying levels of noisiness.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={noisepure2} alt="pure noise 0.2" caption="Persistence 0.2" />
<BlogImage src={noisepure5} alt="pure noise 0.5" caption="Persistence 0.5" />
<BlogImage src={noisepure8} alt="pure noise 0.8" caption="Persistence 0.8" />
</div>

I have implemented Perlin noise to allow flexibility in the colours that the texture is made of. Here is an example of using different colours:

<BlogImage src={noisepurecolour} alt="pure noise colour" />

### Wood grain

Perlin noise can be used to generate wood grain textures. Wood textures work best with low values for persistence; otherwise, the grain is much too chaotic.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={noisewood1} alt="wood noise 0.1" caption="Persistence 0.1" />
<BlogImage src={noisewood2} alt="wood noise 0.2" caption="Persistence 0.2" />
<BlogImage src={noisewood5} alt="wood noise 0.5" caption="Persistence 0.5 - It's starting to get ugly" />
<BlogImage src={noisewood8} alt="wood noise 0.8" caption="Persistence 0.8 - Does not look like wood anymore" />
</div>

We can still specify colours for wood grain textures. So, it is possible to create this "psychedelic" wood:
<BlogImage src={noisewoodcolour} alt="wood noise colour" />

### Marble

Marble textures can be created with Perlin noise. Marble looks best with high values of persistence. Also, it looks most natural if the two colours of the texture are close in shade.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={noisemarble03} alt="marble noise 0.3" caption="Persistence 0.3 - This doesn't look like marble yet" />
<BlogImage src={noisemarble1} alt="marble noise 1.0" caption="Persistence 1.0 - Better" />
<BlogImage src={noisemarble13} alt="marble noise 1.3" caption="Persistence 1.3 - (Arguably) better still" />
<BlogImage src={noisemarble18} alt="marble noise 1.8" caption="Persistence 1.8 - Too chaotic" />
</div>

Perlin noise can be applied to all primitives, as demonstrated here.

<BlogImage src={noiseprimitives} alt="noise primitives" />

It is very difficult to texture map an arbitrary 2-dimensional image to an arbitrary 3-dimensional shape.  However, since Perlin noise is defined in 3 dimensions, it is possible to texture map complex polygonal meshes with noise.  Here, we see a mesh model textured mapped with wood grain and marble textures.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={noisewoodcow} alt="noise wood cow" />
<BlogImage src={noisemarblecow} alt="noise marble cow" />
</div>

## Soft Shadows

Soft shadows can be created using area lights.  Area lights can be partially blocked by objects, which gives the shadow a penumbra and umbra.

<BlogImage src={softshadowpointlight} alt="soft shadow point light" 
  caption={`For comparison, this is what a "hard" shadow looks like, as created by a single point light source.`} />

Area lights are specified as an n x n array of lights.  The larger the value of n, the better the shadow will look.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={softshadow2} alt="soft shadow 2" caption="2 x 2 area light" />
<BlogImage src={softshadow5} alt="soft shadow 5" caption="5 x 5 area light" />
<BlogImage src={softshadow10} alt="soft shadow 10" caption="10 x 10 area light" />
</div>

The size of the light can also be changed.  Larger lights cast softer shadows, and smaller lights cast harder shadows.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={softshadowsize1} alt="soft shadow size 1" caption="A small area light looks almost like a point light source." />
<BlogImage src={softshadowsize2} alt="soft shadow size 2" caption="A large area light casts an extremely blurry shadow." />
</div>

The size of the light can vary in either direction.  Compare these two images: one is a "wide" light, and the other is a "tall" light.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={softshadowsize3} alt="soft light wide" />
<BlogImage src={softshadowsize4} alt="soft light tall" />
</div>

## Glossiness

Glossy reflections are accomplished by distributing a reflection among many reflection rays.  The more reflection rays there are, the better the reflection will look.

<BlogImage src={glossiness1} alt="glossiness 1" caption="For comparison, this is a pure, non-glossy reflection." />

The following sequence shows the effect of increasing the number of rays.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={glossiness1} alt="glossiness 1" caption="2 reflection rays" />
<BlogImage src={glossiness2} alt="glossiness 2" caption="2 reflection rays" />
<BlogImage src={glossiness10} alt="glossiness 10" caption="10 reflection rays" />
<BlogImage src={glossiness50} alt="glossiness 50" caption="50 reflection rays" />
</div>

We can control how scattered the reflection rays are.  This is determined by the specular reflection coefficient of the material.  The higher the specular coefficient, the sharper the reflection.

<div class="responsive-gallery tw-not-prose">
<BlogImage src={glossiness10specular} alt="glossiness 10 specular" caption="Specular coefficient 10" />
<BlogImage src={glossiness40specular} alt="glossiness 40 specular" caption="Specular coefficient 40" />
<BlogImage src={glossiness70specular} alt="glossiness 70 specular" caption="Specular coefficient 70" />
<BlogImage src={glossiness100specular} alt="glossiness 100 specular" caption="Specular coefficient 100" />
</div>

## Final Scene

My final scene depicts a pool room.  Texture mapping is used for most of the objects, most obviously on the walls, and in the painting.  The frame of the table is texture-mapped with wood grain generated from Perlin noise.  Notice also that the surface of the table is not completely uniform in colour; this was also accomplished with Perlin noise.

<BlogImage src={scene} alt="scene" />

<BlogImage src={ball} alt="ball texture" caption="Homemade texture for the balls" />

This is a close-up rendering of the table which more clearly displays the reflectiveness of the balls.  Also, area lights were used to render this scene.

<BlogImage src={table} alt="table" />